define(["jquery","underscore","text!app/timer/style.css","text!app/timer/template.tpl","jquery.knob"],function(a,b,c,d){function e(){this.elementId="#timer",this.timer=new f,this.template=this.compile()}function f(a){var b=a||{};this.frame=b.frame||60,this.remaining=this.frame}return e.prototype={compile:function(){var a="<style>"+c+"</style>"+d;return b.template(a)},render:function(){var b=this.template({secs:this.timer.remaining});a(this.elementId).html(b),this.renderDial()},renderDial:function(){a(this.elementId).find("input").knob({readOnly:!0,width:120,height:120,min:0,max:60,inputColor:"#fff",bgColor:"#6c6",fgColor:"#666",thickness:".30",rotation:"anticlockwise"})},start:function(a){var c=this,d=a||{};this.timer.start({onTick:function(){c.render(),0===c.timer.remaining&&b.isFunction(d.onStop)&&d.onStop()}})},stop:function(){this.timer.stop(),this.render()}},f.prototype={start:function(a){var c=this;this.onTick=a.onTick||b.noop,this.timer=setInterval(function(){c.remaining--,c.onTick(),c.remaining||c.stop()},1e3)},stop:function(){this.remaining=this.frame,clearInterval(this.timer)}},e}),define(["underscore","app/timer/view"],function(a,b){"use strict";describe("TimerView",function(){var a;beforeEach(function(){a=new b,a.render=jasmine.createSpy("render"),jasmine.clock().install()}),afterEach(function(){jasmine.clock().uninstall()}),it("should do a countdown",function(){a.start(),jasmine.clock().tick(3e3),expect(a.timer.remaining).toBe(57)}),it("should do a countdown",function(){var b=jasmine.createSpy("spy");a.start({onStop:function(){b()}}),jasmine.clock().tick(59e3),expect(b).not.toHaveBeenCalled(),jasmine.clock().tick(6e4),expect(b).toHaveBeenCalled()})})});