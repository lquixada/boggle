define(["jquery","underscore","app/base/view","text!app/board/style.css","text!app/board/template.tpl"],function(a,b,c,d,e){"use strict";function f(){this.elementId="#board",this.board=new g}function g(){this.dim=4,this.minLength=2,this.dice=[new h("AOBBOJ"),new h("WHGEEN"),new h("NRNZHL"),new h("NAEAGE"),new h("DIYSTT"),new h("IESTSO"),new h("AOTTWO"),new h("HQUMNI"),new h("RYTLTE"),new h("POHCSA"),new h("LREVYD"),new h("EXLDIR"),new h("IENSUE"),new h("SFFKAP"),new h("IOTMUC"),new h("EHWVTR")],this.reset()}function h(a){this.sides=a.split("")}return f.prototype=b.extend(new c(d,e),{check:function(a){return this.board.check(a)},render:function(){this.renderTemplate({board:this.board.matrix})},start:function(){this.board.start(),this.render()},stop:function(){this.board.stop(),this.render()}}),g.prototype={get:function(a,b){try{return this.matrix[a][b]}catch(c){return"*"}},place:function(a){var c=b.groupBy(a,function(a,b){return b%this.dim},this);return b.toArray(c)},shake:function(){return b.invoke(this.dice,"roll")},start:function(){var a=this.shake();this.matrix=this.place(a)},stop:function(){this.reset()},reset:function(){this.matrix=[[" "," "," "," "],[" "," "," "," "],[" "," "," "," "],[" "," "," "," "]]},check:function(a){if(a.length<this.minLength)return!1;a=a.toUpperCase();for(var b=0;b<this.dim;b++)for(var c=0;c<this.dim;c++)if(this.get(b,c)===a.charAt(0)&&this.findSequence(a,b,c))return!0;return!1},findSequence:function(a,b,c){var d;if(a.length<=1)return!0;d=this.matrix[b][c],this.matrix[b][c]=" ";for(var e=-1;1>=e;e++)for(var f=-1;1>=f;f++)if(this.get(b+e,c+f)===a.charAt(1)&&this.findSequence(a.substr(1),b+e,c+f))return this.matrix[b][c]=d,!0;return this.matrix[b][c]=d,!1}},h.prototype={roll:function(){return b.sample(this.sides)}},f});