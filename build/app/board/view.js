define(["react","underscore"],function(a,b){"use strict";function c(){this.dim=4,this.minLength=2,this.dice=[new d("AOBBOJ"),new d("WHGEEN"),new d("NRNZHL"),new d("NAEAGE"),new d("DIYSTT"),new d("IESTSO"),new d("AOTTWO"),new d("HQUMNI"),new d("RYTLTE"),new d("POHCSA"),new d("LREVYD"),new d("EXLDIR"),new d("IENSUE"),new d("SFFKAP"),new d("IOTMUC"),new d("EHWVTR")],this.reset()}function d(a){this.sides=a.split("")}var e=a.createClass({displayName:"BoardView",getInitialState:function(){return{board:new c}},check:function(a){return this.state.board.check(a)},componentWillUpdate:function(){this.props.started?this.state.board.stop():this.state.board.start()},getRows:function(b){return b.matrix.map(function(b,c){return a.createElement("tr",{key:c},this.getCells(b))},this)},getCells:function(b){return b.map(function(b,c){return a.createElement("td",{key:c},b)})},render:function(){return a.createElement("div",{id:"board",className:"box"},a.createElement("table",null,a.createElement("tbody",null,this.getRows(this.state.board))))}});return c.prototype={get:function(a,b){try{return this.matrix[a][b]}catch(c){return"*"}},place:function(a){var c=b.groupBy(a,function(a,b){return b%this.dim},this);return b.toArray(c)},shake:function(){return b.invoke(this.dice,"roll")},start:function(){var a=this.shake();this.matrix=this.place(a)},stop:function(){this.reset()},reset:function(){this.matrix=[[" "," "," "," "],[" "," "," "," "],[" "," "," "," "],[" "," "," "," "]]},check:function(a){if(a.length<this.minLength)return!1;a=a.toUpperCase();for(var b=0;b<this.dim;b++)for(var c=0;c<this.dim;c++)if(this.get(b,c)===a.charAt(0)&&this.findSequence(a,b,c))return!0;return!1},findSequence:function(a,b,c){var d;if(a.length<=1)return!0;d=this.matrix[b][c],this.matrix[b][c]=" ";for(var e=-1;1>=e;e++)for(var f=-1;1>=f;f++)if(this.get(b+e,c+f)===a.charAt(1)&&this.findSequence(a.substr(1),b+e,c+f))return this.matrix[b][c]=d,!0;return this.matrix[b][c]=d,!1}},d.prototype={roll:function(){return b.sample(this.sides)}},e});